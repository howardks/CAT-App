@page "/login"

@inject NavigationManager NavigationManager
@using CAT_App.Data;

<img src="/images/fountain.jpg" />
<p />
<h4>@(GetSignUp() ? "Sign Up" : "Login")</h4>
<p />
<form class="login-form">
    <label for="username">Username: </label>
    <br />
    <input id="username" type="text" placeholder="username" @bind-value="username"/>
    <p />
    <label for="password">Password: </label>
    <br />
    <input id="password" type="password" placeholder="password" @bind-value="password"/>
    <p />
    <div class="@(GetSignUp()? "d-show" : "d-none")">
        <label for="passwordRepeat">Retype Password: </label>
        <br />
        <input id="passwordRepeat" type="password" placeholder="retype password" @bind-value="passwordRepeat" />
        <p />
    </div>
    <div class="flex-container">
        <input type="button" value="@(GetSignUp()? "Back" : "Login")" @onclick="@(GetSignUp()? ChangeMode : LoginUser)" />
        <input type="button" value="Sign Up" @onclick="@(GetSignUp()? SignUpUser : ChangeMode)" />
    </div>
</form>


@code {
    string username, password, passwordRepeat;
    bool signUp = false;

    private void LoginUser()
    {
        // Do all the login stuff


        // Then navigate to account if user is logged in successfully
        if (User.LoggedIn)
        {
            NavigationManager.NavigateTo("/account");
        } 
        else
        {
            // Figure out popup for failure

        }
    }

    private void SignUpUser()
    {
        // Do all the registration stuff
        if (username != null && !username.Equals("") &&
            password != null && !password.Equals("") &&
            passwordRepeat != null && !passwordRepeat.Equals(""))
        {
            User.Register(username, password, passwordRepeat);

            // Figure out what to do next

        }
        else
        {
            // Figure out popup for empty fields

        }
    }

    private void ChangeMode()
    {
        passwordRepeat = null;

        if (signUp)
        {
            signUp = false;
        }
        else
        {
            signUp = true;
        }
    }

    private bool GetSignUp()
    {
        return signUp;
    }

    private void NavigateToSignUp()
    {
        NavigationManager.NavigateTo("/signup");
    }
}
